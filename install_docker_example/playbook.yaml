- name: Install Docker
  hosts: all

  vars:
    docker_requirements:
      - ca-certificates
      - curl
      - gnupg
      - lsb-release

    docker_packages:
      - docker-ce
      - docker-ce-cli
      - containerd.io

  tasks: 
    - name: Upgrade system
      become: yes
      apt:
        update_cache: yes
        upgrade: yes
        
    - name: Check docker installation
      register: result
      ignore_errors: yes
      shell: which docker

    - name: Install docker requirements
      when: result.rc != 0
      become: yes
      apt:
        name: "{{ docker_requirements }}"
        state: present

    - name: Add Docker GPG apt Key
      when: result.rc != 0
      become: yes
      apt_key:
        url: https://download.docker.com/linux/ubuntu/gpg
        state: present

    - name: Add Docker Repository
      when: result.rc != 0
      become: yes
      apt_repository:
        repo: deb https://download.docker.com/linux/ubuntu {{ ansible_facts.lsb.codename }} stable
        state: present

    - name: Install Docker packages
      when: result.rc != 0
      become: yes
      apt:
        name: "{{ docker_packages }}"
        state: present
      
